module.exports=[51494,a=>{"use strict";var b=a.i(87924),c=a.i(5050);let d=(0,c.createServerReference)("703854b2d1158bb90b3265336d860233239a09726f",c.callServer,void 0,c.findSourceMapURL,"updateRecipe");var e=a.i(38246),f=a.i(25707),g=a.i(3471),h=a.i(72131);let i={KG:1,G:.001,L:1,ML:.001,UD:1};function j({recipe:a,ingredients:c,categories:j,packaging:k,availableSubRecipes:l=[]}){let m=d.bind(null,a.id),[n,o]=(0,h.useActionState)(m,{message:null,errors:{}}),[p,q]=(0,h.useState)(a.yieldQuantity||1),[r,s]=(0,h.useState)(a.items.map(a=>({key:a.id,id:a.id,type:a.type,ingredientId:a.ingredientId||"",subRecipeId:a.subRecipeId||"",sourceProductId:a.sourceProductId||"",quantityGross:a.quantityGross,unit:a.unit}))),t=(a,b,c)=>{let d=[...r];d[a]={...d[a],[b]:c},"ingredientId"===b&&(d[a].sourceProductId=""),s(d)},[u,v]=(0,h.useState)((a.steps||[]).sort((a,b)=>a.order-b.order).map(a=>({key:a.id,order:a.order,description:a.description,action:a.action||"",subAction:a.subAction||"",ingredientId:a.ingredientId||""}))),w={CORTAR:["Brunoisse","Juliana","Mirepoix","Rodajas","Gajos"],DESPIEZAR:["Filetear","Picar","Limpiar","Deshuesar"],COCCION:["Directa","Indirecta","Al vacío","Hervir","Sofreír","Asar"],MEZCLAR:["Batir","Remover","Amasar"],OTROS:["Marinar","Reposar","Emplatar"]},x=(a,b,c)=>{let d=[...u];d[a]={...d[a],[b]:c},"action"===b&&(d[a].subAction=""),v(d)},y=r.reduce((a,b)=>{if("INGREDIENT"===b.type&&b.ingredientId){let g=c.find(a=>a.id===b.ingredientId);if(g){var d,e,f;let c=(d=b.quantityGross,(e=b.unit)===(f=g.pricingUnit)?d:("KG"===e||"G"===e)&&("KG"===f||"G"===f)||("L"===e||"ML"===e)&&("L"===f||"ML"===f)?d*i[e]/i[f]:"UD"===e&&"UD"===f?d:null);if(null!==c)return a+c*g.pricePerUnit}}return a},0),z=r.map(a=>{let b=c.find(b=>b.id===a.ingredientId);return b?{id:b.id,name:b.name}:null}).filter(Boolean);return(0,b.jsxs)("form",{action:o,children:[(0,b.jsxs)("div",{className:"rounded-md bg-gray-50 p-4 md:p-6",children:[(0,b.jsxs)("div",{className:"mb-6 grid grid-cols-2 gap-4 rounded-lg bg-blue-50 p-4 border border-blue-100",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-blue-600 font-semibold",children:"Coste Total Receta"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-blue-800",children:new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(y)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-green-600 font-semibold",children:"Coste por Ración/Unidad"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-green-800",children:new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(p>0?y/p:0)})]})]}),(0,b.jsx)("input",{type:"hidden",name:"items",value:JSON.stringify(r)}),(0,b.jsx)("input",{type:"hidden",name:"steps",value:JSON.stringify(u)}),(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("label",{htmlFor:"name",className:"mb-2 block text-sm font-medium",children:"Nombre de la Receta"}),(0,b.jsxs)("div",{className:"relative mt-2 rounded-md",children:[(0,b.jsx)("input",{id:"name",name:"name",type:"text",defaultValue:a.name,placeholder:"Ej. Salsa Boloñesa",className:"peer block w-full rounded-md border border-gray-200 py-2 pl-4 text-sm outline-2 placeholder:text-gray-500","aria-describedby":"name-error"}),(0,b.jsx)("div",{id:"name-error","aria-live":"polite","aria-atomic":"true",children:n.errors?.name&&n.errors.name.map(a=>(0,b.jsx)("p",{className:"mt-2 text-sm text-red-500",children:a},a))})]})]}),(0,b.jsxs)("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-3 gap-4 border-b pb-6 border-gray-200",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"classification",className:"mb-2 block text-sm font-medium",children:"Clasificación"}),(0,b.jsxs)("select",{id:"classification",name:"classification",className:"peer block w-full rounded-md border border-gray-200 py-2 pl-4 text-sm outline-2 placeholder:text-gray-500",defaultValue:a.classification||"",children:[(0,b.jsx)("option",{value:"",disabled:!0,children:"Seleccionar Clasificación..."}),j.map(a=>(0,b.jsx)("option",{value:a.name,children:a.name},a.id))]}),(0,b.jsx)("div",{id:"classification-error","aria-live":"polite","aria-atomic":"true",children:n.errors?.classification&&n.errors.classification.map(a=>(0,b.jsx)("p",{className:"mt-2 text-sm text-red-500",children:a},a))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"category",className:"mb-2 block text-sm font-medium",children:"Tipo de Receta"}),(0,b.jsxs)("select",{id:"category",name:"category",className:"peer block w-full rounded-md border border-gray-200 py-2 pl-4 text-sm outline-2 placeholder:text-gray-500",defaultValue:a.category||"ELABORACION_FINAL",children:[(0,b.jsx)("option",{value:"PRODUCTO_NO_ELABORADO",children:"Producto No Elaborado"}),(0,b.jsx)("option",{value:"ELABORACION_INTERMEDIA",children:"Elaboración Intermedia"}),(0,b.jsx)("option",{value:"ELABORACION_FINAL",children:"Elaboración Final"})]}),(0,b.jsx)("div",{id:"category-error","aria-live":"polite","aria-atomic":"true",children:n.errors?.category&&n.errors.category.map(a=>(0,b.jsx)("p",{className:"mt-2 text-sm text-red-500",children:a},a))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"packaging",className:"mb-2 block text-sm font-medium",children:"Envasado / Molde"}),(0,b.jsxs)("select",{id:"packaging",name:"packaging",defaultValue:a.packaging||"",className:"peer block w-full rounded-md border border-gray-200 py-2 pl-4 text-sm outline-2 placeholder:text-gray-500",children:[(0,b.jsx)("option",{value:"",children:"Seleccionar Envase..."}),k.map(a=>(0,b.jsx)("option",{value:a.name,children:a.name},a.id))]}),(0,b.jsx)("div",{id:"packaging-error","aria-live":"polite","aria-atomic":"true",children:n.errors?.packaging&&n.errors.packaging.map(a=>(0,b.jsx)("p",{className:"mt-2 text-sm text-red-500",children:a},a))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"portions",className:"mb-2 block text-sm font-medium",children:"Nº Raciones"}),(0,b.jsx)("input",{id:"portions",name:"portions",type:"number",defaultValue:a.portions||"",placeholder:"Ej. 36",className:"peer block w-full rounded-md border border-gray-200 py-2 pl-4 text-sm placeholder:text-gray-500"}),(0,b.jsx)("div",{id:"portions-error","aria-live":"polite","aria-atomic":"true",children:n.errors?.portions&&n.errors.portions.map(a=>(0,b.jsx)("p",{className:"mt-2 text-sm text-red-500",children:a},a))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"prepTime",className:"mb-2 block text-sm font-medium",children:"Tiempo Preparación (mins)"}),(0,b.jsx)("input",{id:"prepTime",name:"prepTime",type:"number",defaultValue:a.prepTime||"",placeholder:"15",className:"peer block w-full rounded-md border border-gray-200 py-2 pl-4 text-sm placeholder:text-gray-500"}),(0,b.jsx)("div",{id:"prepTime-error","aria-live":"polite","aria-atomic":"true",children:n.errors?.prepTime&&n.errors.prepTime.map(a=>(0,b.jsx)("p",{className:"mt-2 text-sm text-red-500",children:a},a))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"cookTime",className:"mb-2 block text-sm font-medium",children:"Tiempo Cocción (mins)"}),(0,b.jsx)("input",{id:"cookTime",name:"cookTime",type:"number",defaultValue:a.cookTime||"",placeholder:"27",className:"peer block w-full rounded-md border border-gray-200 py-2 pl-4 text-sm placeholder:text-gray-500"}),(0,b.jsx)("div",{id:"cookTime-error","aria-live":"polite","aria-atomic":"true",children:n.errors?.cookTime&&n.errors.cookTime.map(a=>(0,b.jsx)("p",{className:"mt-2 text-sm text-red-500",children:a},a))})]})]}),(0,b.jsxs)("div",{className:"mb-4 grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"yieldQuantity",className:"mb-2 block text-sm font-medium",children:"Rendimiento (Cantidad)"}),(0,b.jsx)("input",{id:"yieldQuantity",name:"yieldQuantity",type:"number",step:"0.01",defaultValue:a.yieldQuantity,onChange:a=>q(parseFloat(a.target.value)||0),className:"peer block w-full rounded-md border border-gray-200 py-2 pl-4 text-sm outline-2 placeholder:text-gray-500"}),(0,b.jsx)("div",{id:"yieldQuantity-error","aria-live":"polite","aria-atomic":"true",children:n.errors?.yieldQuantity&&n.errors.yieldQuantity.map(a=>(0,b.jsx)("p",{className:"mt-2 text-sm text-red-500",children:a},a))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"yieldUnit",className:"mb-2 block text-sm font-medium",children:"Unidad"}),(0,b.jsxs)("select",{id:"yieldUnit",name:"yieldUnit",className:"peer block w-full rounded-md border border-gray-200 py-2 pl-4 text-sm outline-2 placeholder:text-gray-500",defaultValue:a.yieldUnit||"KG",children:[(0,b.jsx)("option",{value:"KG",children:"KG"}),(0,b.jsx)("option",{value:"L",children:"L"}),(0,b.jsx)("option",{value:"UD",children:"Raciones / Unidades"})]}),(0,b.jsx)("div",{id:"yieldUnit-error","aria-live":"polite","aria-atomic":"true",children:n.errors?.yieldUnit&&n.errors.yieldUnit.map(a=>(0,b.jsx)("p",{className:"mt-2 text-sm text-red-500",children:a},a))})]})]}),(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("label",{htmlFor:"instructions",className:"mb-2 block text-sm font-medium",children:"Notas"}),(0,b.jsx)("textarea",{id:"instructions",name:"instructions",rows:3,defaultValue:a.instructions||"",className:"peer block w-full rounded-md border border-gray-200 py-2 pl-4 text-sm outline-2 placeholder:text-gray-500"})]}),(0,b.jsxs)("div",{className:"mb-4 mt-8",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("h3",{className:"text-lg font-bold",children:"Ingredientes"}),(0,b.jsxs)("button",{type:"button",onClick:()=>{s([...r,{key:crypto.randomUUID(),type:"INGREDIENT",ingredientId:"",subRecipeId:"",sourceProductId:"",quantityGross:0,unit:"KG"}])},className:"flex items-center gap-1 rounded bg-blue-100 px-3 py-1 text-sm text-blue-600 hover:bg-blue-200",children:[(0,b.jsx)(f.PlusIcon,{className:"w-4"})," Añadir Item"]})]}),0===r.length&&(0,b.jsx)("p",{className:"text-gray-500 italic text-sm",children:"No hay ingredientes añadidos."}),(0,b.jsx)("div",{className:"space-y-2",children:r.map((a,d)=>{let e;return(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-2 items-start md:items-center p-3 bg-white rounded border border-gray-200",children:[(0,b.jsx)("div",{className:"w-full md:w-32",children:(0,b.jsxs)("select",{className:"block w-full rounded-md border-gray-200 text-sm font-medium",value:a.type,onChange:a=>{let b=a.target.value,c=[...r];c[d]={...c[d],type:b,ingredientId:"",subRecipeId:"",sourceProductId:""},s(c)},children:[(0,b.jsx)("option",{value:"INGREDIENT",children:"Ingrediente"}),(0,b.jsx)("option",{value:"SUB_RECIPE",children:"Sub-Receta"})]})}),(0,b.jsx)("div",{className:"flex-grow w-full md:w-auto",children:"INGREDIENT"===a.type?(0,b.jsxs)("select",{className:"block w-full rounded-md border-gray-200 text-sm",value:a.ingredientId,onChange:a=>t(d,"ingredientId",a.target.value),children:[(0,b.jsx)("option",{value:"",children:"Seleccionar Ingrediente..."}),c.map(a=>{let c=a.name,d=a.transformationOutputs?.map(a=>a.transformation.sourceProduct.name);if(d&&d.length>0){let b=Array.from(new Set(d));c=`${b.join(" / ")} - ${a.name}`}return(0,b.jsxs)("option",{value:a.id,children:[c," (",a.pricingUnit,")"]},a.id)})]}):(0,b.jsxs)("select",{className:"block w-full rounded-md border-gray-200 text-sm",value:a.subRecipeId,onChange:a=>t(d,"subRecipeId",a.target.value),children:[(0,b.jsx)("option",{value:"",children:"Seleccionar Sub-Receta..."}),l.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]})}),(e=c.find(b=>b.id===a.ingredientId))&&e.transformationOutputs&&e.transformationOutputs.length>0?(0,b.jsx)("div",{className:"flex-grow w-full md:w-auto",children:(0,b.jsxs)("select",{className:"block w-full rounded-md border-gray-200 text-sm text-gray-600",value:a.sourceProductId||"",onChange:a=>t(d,"sourceProductId",a.target.value),children:[(0,b.jsx)("option",{value:"",children:"-- Origen Genérico --"}),e.transformationOutputs.map(a=>(0,b.jsxs)("option",{value:a.transformation.sourceProduct.id,children:[a.transformation.sourceProduct.supplier?`${a.transformation.sourceProduct.supplier} - `:"",a.transformation.sourceProduct.name," (",a.percentage.toFixed(0),"%)"]},a.transformation.sourceProduct.id))]})}):null,(0,b.jsx)("div",{className:"w-full md:w-24",children:(0,b.jsx)("input",{type:"number",step:"any",placeholder:"Cant.",className:"block w-full rounded-md border-gray-200 text-sm",value:a.quantityGross,onChange:a=>t(d,"quantityGross",parseFloat(a.target.value))})}),(0,b.jsx)("div",{className:"w-full md:w-24",children:(0,b.jsxs)("select",{className:"block w-full rounded-md border-gray-200 text-sm",value:a.unit,onChange:a=>t(d,"unit",a.target.value),children:[(0,b.jsx)("option",{value:"KG",children:"KG"}),(0,b.jsx)("option",{value:"G",children:"G"}),(0,b.jsx)("option",{value:"L",children:"L"}),(0,b.jsx)("option",{value:"ML",children:"ML"}),(0,b.jsx)("option",{value:"UD",children:"UD"})]})}),(0,b.jsx)("button",{type:"button",onClick:()=>{let a;(a=[...r]).splice(d,1),s(a)},className:"text-red-500 hover:text-red-700 p-1",children:(0,b.jsx)(g.TrashIcon,{className:"w-5"})})]},a.key)})})]}),(0,b.jsxs)("div",{className:"mb-6 mt-8",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("h3",{className:"text-lg font-bold",children:"Método de elaboración (Pasos)"}),(0,b.jsxs)("button",{type:"button",onClick:()=>{v([...u,{key:crypto.randomUUID(),order:u.length+1,description:"",action:"",subAction:"",ingredientId:""}])},className:"flex items-center gap-1 rounded bg-blue-100 px-3 py-1 text-sm text-blue-600 hover:bg-blue-200",children:[(0,b.jsx)(f.PlusIcon,{className:"w-4"})," Añadir Paso"]})]}),0===u.length&&(0,b.jsx)("p",{className:"text-gray-500 italic text-sm",children:"No hay pasos definidos."}),(0,b.jsx)("div",{className:"space-y-4",children:u.map((a,c)=>(0,b.jsxs)("div",{className:"flex flex-col gap-2 p-3 bg-white rounded border border-gray-200 shadow-sm",children:[(0,b.jsxs)("div",{className:"flex gap-2 items-start",children:[(0,b.jsx)("span",{className:"flex-none flex items-center justify-center w-6 h-6 rounded-full bg-gray-100 font-bold text-xs text-gray-600 mt-1",children:a.order}),(0,b.jsx)("textarea",{className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm",rows:2,placeholder:"",value:a.description,onChange:a=>x(c,"description",a.target.value)}),(0,b.jsx)("button",{type:"button",onClick:()=>{let a;(a=[...u]).splice(c,1),v(a.map((a,b)=>({...a,order:b+1})))},className:"text-red-500 hover:text-red-700 p-1",children:(0,b.jsx)(g.TrashIcon,{className:"w-5"})})]}),(0,b.jsxs)("div",{className:"ml-8 flex flex-wrap gap-2 items-center",children:[(0,b.jsxs)("select",{className:"text-xs rounded border-gray-200 py-1 pl-2 pr-6",value:a.action||"",onChange:a=>x(c,"action",a.target.value),children:[(0,b.jsx)("option",{value:"",children:"-- Acción --"}),Object.keys(w).map(a=>(0,b.jsx)("option",{value:a,children:a},a))]}),a.action&&w[a.action]&&(0,b.jsxs)("select",{className:"text-xs rounded border-gray-200 py-1 pl-2 pr-6",value:a.subAction||"",onChange:a=>x(c,"subAction",a.target.value),children:[(0,b.jsx)("option",{value:"",children:"-- Técnica --"}),w[a.action].map(a=>(0,b.jsx)("option",{value:a,children:a},a))]}),(0,b.jsxs)("select",{className:"text-xs rounded border-gray-200 py-1 pl-2 pr-6 max-w-[150px]",value:a.ingredientId||"",onChange:a=>x(c,"ingredientId",a.target.value),children:[(0,b.jsx)("option",{value:"",children:"-- Ingrediente Relacionado --"}),z.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]})]})]},a.key))})]}),(0,b.jsx)("div",{"aria-live":"polite","aria-atomic":"true",children:n.message&&(0,b.jsx)("p",{className:"mt-2 text-sm text-red-500",children:n.message})})]}),(0,b.jsxs)("div",{className:"mt-6 flex justify-end gap-4",children:[(0,b.jsx)(e.default,{href:"/dashboard/recipes",className:"flex h-10 items-center rounded-lg bg-gray-100 px-4 text-sm font-medium text-gray-600 transition-colors hover:bg-gray-200",children:"Cancelar"}),(0,b.jsx)("button",{type:"submit",className:"flex h-10 items-center rounded-lg bg-blue-600 px-4 text-sm font-medium text-white transition-colors hover:bg-blue-500",children:"Actualizar Receta"})]})]})}a.s(["default",()=>j],51494)}];

//# sourceMappingURL=apps_web_app_ui_recipes_edit-form_tsx_b8b9edae._.js.map