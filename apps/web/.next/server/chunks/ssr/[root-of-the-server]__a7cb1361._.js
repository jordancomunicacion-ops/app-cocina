module.exports=[37936,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(11857)},13095,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},25982,a=>{"use strict";var b=a.i(53112);let c=b.z.object({id:b.z.string(),name:b.z.string().min(1,{message:"El nombre es obligatorio."}),category:b.z.string().optional(),pricingUnit:b.z.enum(["KG","G","L","ML","UD"]),pricePerUnit:b.z.coerce.number().gt(0,{message:"El precio debe ser mayor a 0."}),yieldPercent:b.z.coerce.number().min(0).max(100,{message:"El rendimiento debe estar entre 0 y 100."}),allergens:b.z.string().optional(),supplierId:b.z.string().optional()}),d=c.omit({id:!0}),e=b.z.object({id:b.z.string().optional(),ingredientId:b.z.string().optional().nullable(),subRecipeId:b.z.string().optional().nullable(),sourceProductId:b.z.string().optional().nullable(),type:b.z.enum(["INGREDIENT","SUB_RECIPE"]),quantityGross:b.z.coerce.number().gt(0,{message:"La cantidad debe ser mayor a 0."}),unit:b.z.enum(["KG","G","L","ML","UD"])}),f=b.z.object({id:b.z.string().optional(),order:b.z.coerce.number(),description:b.z.string().min(1,{message:"La descripción es obligatoria."}),action:b.z.string().optional(),subAction:b.z.string().optional(),ingredientId:b.z.string().optional().nullable()}),g=b.z.object({id:b.z.string(),name:b.z.string().min(1,{message:"El nombre es obligatorio."}),category:b.z.enum(["PRODUCTO_NO_ELABORADO","ELABORACION_INTERMEDIA","ELABORACION_FINAL"]),classification:b.z.string().optional(),packaging:b.z.string().optional(),portions:b.z.preprocess(a=>""===a?null:Number(a),b.z.number().min(1,{message:"Debe ser mayor a 0"}).optional().nullable()),prepTime:b.z.preprocess(a=>""===a?null:Number(a),b.z.number().min(0).optional().nullable()),cookTime:b.z.preprocess(a=>""===a?null:Number(a),b.z.number().min(0).optional().nullable()),yieldQuantity:b.z.coerce.number().gt(0,{message:"El rendimiento debe ser mayor a 0."}),yieldUnit:b.z.enum(["KG","G","L","ML","UD"]).optional(),instructions:b.z.string().optional(),items:b.z.array(e).optional(),steps:b.z.array(f).optional()}),h=g.omit({id:!0}),i=b.z.object({id:b.z.string().optional(),recipeId:b.z.string().min(1,{message:"Debe seleccionar una receta."}),servingsOverride:b.z.coerce.number().optional().nullable()}),j=b.z.object({id:b.z.string(),name:b.z.string().min(1,{message:"El nombre del evento es obligatorio."}),date:b.z.string().transform(a=>new Date(a)),pax:b.z.coerce.number().gt(0,{message:"El número de personas debe ser mayor a 0."}),safetyMargin:b.z.coerce.number().min(1,{message:"El margen debe ser al menos 1.0 (100%)."}),status:b.z.enum(["DRAFT","CONFIRMED","COMPLETED"]).optional(),menuItems:b.z.array(i).optional()}),k=j.omit({id:!0}),l=b.z.object({id:b.z.string(),name:b.z.string().min(1,{message:"El nombre es obligatorio."}),email:b.z.string().email({message:"Email inválido."}),password:b.z.string().min(6,{message:"La contraseña debe tener al menos 6 caracteres."}).optional(),role:b.z.enum(["ADMIN","CHEF","EMPLOYEE"]),firstName:b.z.string().optional(),lastName:b.z.string().optional(),dni:b.z.string().optional(),phone:b.z.string().optional(),jobTitle:b.z.string().optional(),dob:b.z.string().optional()}),m=l.omit({id:!0}).extend({password:b.z.string().min(6,{message:"La contraseña es obligatoria."})}),n=b.z.object({id:b.z.string(),title:b.z.string().min(1,{message:"El título es obligatorio."}),description:b.z.string().optional(),assignedToUserId:b.z.string().optional().nullable(),status:b.z.enum(["PENDING","IN_PROGRESS","DONE","ISSUE"]),recipeId:b.z.string().optional().nullable(),targetQuantity:b.z.coerce.number().optional().nullable(),plannedStart:b.z.string().optional().nullable(),plannedEnd:b.z.string().optional().nullable()}).omit({id:!0,status:!0});a.s(["CreateEventSchema",0,k,"CreateIngredientSchema",0,d,"CreateRecipeSchema",0,h,"CreateTaskSchema",0,n,"CreateUserSchema",0,m,"UpdateEventSchema",0,j,"UpdateIngredientSchema",0,c,"UpdateRecipeSchema",0,g,"UpdateUserSchema",0,l])},82919,a=>a.a(async(b,c)=>{try{var d=a.i(37936),e=a.i(47525);a.i(40522);var f=a.i(9349),g=a.i(25982),h=a.i(44950),i=a.i(63021);a.i(70396);var j=a.i(73727),k=a.i(13095),l=b([e,h]);async function m(a,b){try{await (0,e.signIn)("credentials",{...Object.fromEntries(b),redirectTo:"/dashboard"})}catch(a){if(console.error("Auth Error:",a),a instanceof f.AuthError){if(console.error("Auth Error Type:",a.type),"CredentialsSignin"===a.type)return"Invalid credentials.";return"Something went wrong."}throw a}}async function n(){await (0,e.signOut)()}[e,h]=l.then?(await l)():l;let p=new i.PrismaClient;async function o(a,b){let c=g.CreateUserSchema.safeParse({name:b.get("name"),email:b.get("email"),password:b.get("password"),role:b.get("role")});if(!c.success)return{errors:c.error.flatten().fieldErrors,message:"Faltan campos obligatorios. Error al registrar usuario."};let{name:d,email:e,password:f,role:i}=c.data,k=await h.default.hash(f,10);try{await p.user.create({data:{name:d,email:e,password:k,role:i}})}catch(a){if("P2002"===a.code)return{message:"El email ya está uso."};return{message:"Error de base de datos: Error al registrar usuario."}}(0,j.redirect)("/login")}(0,k.ensureServerEntryExports)([m,n,o]),(0,d.registerServerReference)(m,"60adfdadc4b7b21a8f0a83aa2edaa389f39f0e987d",null),(0,d.registerServerReference)(n,"007ee69180cc5dfd929eff6368f4b57b396a0cb651",null),(0,d.registerServerReference)(o,"60622933cf9ec826cda69d3234a9eefe6e39396909",null),a.s(["authenticate",()=>m,"registerUser",()=>o,"signOutAction",()=>n]),c()}catch(a){c(a)}},!1),24868,(a,b,c)=>{b.exports=a.x("fs/promises",()=>require("fs/promises"))},86194,a=>a.a(async(b,c)=>{try{var d=a.i(37936),e=a.i(73794),f=a.i(18558),g=a.i(53112),h=a.i(47525),i=a.i(24868),j=a.i(14747),k=a.i(13095),l=b([h]);[h]=l.then?(await l)():l;let u=g.z.object({name:g.z.string().min(1,"El nombre es obligatorio").max(50)});async function m(a,b){let c=u.safeParse({name:b.get("name")});if(!c.success)return{errors:c.error.flatten().fieldErrors,message:"Faltan campos obligatorios."};let{name:d}=c.data;try{return await e.prisma.recipeCategory.create({data:{name:d}}),(0,f.revalidatePath)("/dashboard/settings"),(0,f.revalidatePath)("/dashboard/recipes/create"),(0,f.revalidatePath)("/dashboard/recipes/[id]/edit"),{message:"Categoría creada con éxito."}}catch(a){return console.error("Database Error:",a),{message:"Error de base de datos: No se pudo crear la categoría."}}}async function n(a){try{await e.prisma.recipeCategory.delete({where:{id:a}}),(0,f.revalidatePath)("/dashboard/settings"),(0,f.revalidatePath)("/dashboard/recipes/create")}catch(a){throw console.error("Failed to delete category:",a),Error("Failed to delete category.")}}async function o(){try{return await e.prisma.recipeCategory.findMany({orderBy:{name:"asc"}})}catch(a){throw console.error("Failed to fetch categories:",a),Error("Failed to fetch categories.")}}let v=g.z.object({name:g.z.string().min(1,"El nombre es obligatorio").max(50)});async function p(a,b){let c=v.safeParse({name:b.get("name")});if(!c.success)return{errors:c.error.flatten().fieldErrors,message:"Faltan campos obligatorios."};let{name:d}=c.data;try{return await e.prisma.recipePackaging.create({data:{name:d}}),(0,f.revalidatePath)("/dashboard/settings"),(0,f.revalidatePath)("/dashboard/recipes/create"),(0,f.revalidatePath)("/dashboard/recipes/[id]/edit"),{message:"Envase creado con éxito."}}catch(a){return console.error("Database Error:",a),{message:"Error de base de datos: No se pudo crear el envase."}}}async function q(a){try{return await e.prisma.recipePackaging.delete({where:{id:a}}),(0,f.revalidatePath)("/dashboard/settings"),(0,f.revalidatePath)("/dashboard/recipes/create"),{message:"Envase eliminado."}}catch(a){throw console.error("Failed to delete packaging:",a),Error("Failed to delete packaging.")}}async function r(){try{return await e.prisma.recipePackaging.findMany({orderBy:{name:"asc"}})}catch(a){throw console.error("Failed to fetch packaging:",a),Error("Failed to fetch packaging.")}}async function s(a){try{let b=await (0,h.auth)(),c=b?.user?.id||b?.user?.email;if(!c)return{error:"No autenticado"};let d=a.get("file");if(!d)return{error:"No se seleccionó ningún archivo"};if(!d.type.startsWith("image/"))return{error:"El archivo debe ser una imagen"};let g=j.default.join(process.cwd(),"public","uploads","profiles");await (0,i.mkdir)(g,{recursive:!0});let k=j.default.extname(d.name),l=String(c).replace(/[^a-zA-Z0-9]/g,"_"),m=`${l}_${Date.now()}${k}`,n=j.default.join(g,m),o=await d.arrayBuffer(),p=Buffer.from(o);await (0,i.writeFile)(n,p);let q=`/uploads/profiles/${m}`,r=await e.prisma.user.findFirst({where:b?.user?.id?{id:b.user.id}:{email:b?.user?.email}});if(!r)return{error:"Usuario no encontrado"};return await e.prisma.user.update({where:{id:r.id},data:{image:q}}),(0,f.revalidatePath)("/dashboard/profile"),{success:!0,imageUrl:q}}catch(a){return console.error("Error uploading profile image:",a),{error:`Error al subir la imagen: ${a instanceof Error?a.message:"Desconocido"}`}}}async function t(a){try{let b=await (0,h.auth)();if(!b?.user?.role||"ADMIN"!==b.user.role)return{error:"Solo administradores pueden cambiar el logo"};let c=a.get("file");if(!c)return{error:"No se seleccionó ningún archivo"};if(!c.type.startsWith("image/"))return{error:"El archivo debe ser una imagen"};let d=j.default.join(process.cwd(),"public","uploads","app");await (0,i.mkdir)(d,{recursive:!0});let g=j.default.extname(c.name),k=`logo_${Date.now()}${g}`,l=j.default.join(d,k),m=await c.arrayBuffer(),n=Buffer.from(m);await (0,i.writeFile)(l,n);let o=`/uploads/app/${k}`;return await e.prisma.appConfig.upsert({where:{id:"default"},update:{logoUrl:o},create:{id:"default",logoUrl:o}}),(0,f.revalidatePath)("/dashboard/profile"),(0,f.revalidatePath)("/login"),{success:!0,imageUrl:o}}catch(a){return console.error("Error uploading app logo:",a),{error:"Error al subir el logo"}}}(0,k.ensureServerEntryExports)([m,n,o,p,q,r,s,t]),(0,d.registerServerReference)(m,"600eca4aada408c9eb6b461f06c64d529daa06496d",null),(0,d.registerServerReference)(n,"40b5ec606dadd81bccf8a8dbc17f166a773179ab91",null),(0,d.registerServerReference)(o,"00fda73a4157b6d52c4112d7f9001edcf3680f59bf",null),(0,d.registerServerReference)(p,"608ea7852674dfc3151bd8e7396758508c2f77df01",null),(0,d.registerServerReference)(q,"40a3b9a2f61c8584261559c7f3c9647c55d1d38abe",null),(0,d.registerServerReference)(r,"0099b3c07a6110f09cff517c0534184c8aeb916f87",null),(0,d.registerServerReference)(s,"404e9aa237bfaa1c902d052053b78dbae258aedce6",null),(0,d.registerServerReference)(t,"40dc9989f36939aabed70c6c2aade45aabe811ce84",null),a.s(["createCategory",()=>m,"createPackaging",()=>p,"deleteCategory",()=>n,"deletePackaging",()=>q,"fetchCategories",()=>o,"fetchPackaging",()=>r,"updateAppLogo",()=>t,"updateProfileImage",()=>s]),c()}catch(a){c(a)}},!1),14263,a=>a.a(async(b,c)=>{try{var d=a.i(82919),e=a.i(86194),f=b([d,e]);[d,e]=f.then?(await f)():f,a.s([]),c()}catch(a){c(a)}},!1),77430,a=>a.a(async(b,c)=>{try{var d=a.i(14263),e=a.i(82919),f=a.i(86194),g=b([d,e,f]);[d,e,f]=g.then?(await g)():g,a.s(["007ee69180cc5dfd929eff6368f4b57b396a0cb651",()=>e.signOutAction,"0099b3c07a6110f09cff517c0534184c8aeb916f87",()=>f.fetchPackaging,"00fda73a4157b6d52c4112d7f9001edcf3680f59bf",()=>f.fetchCategories,"404e9aa237bfaa1c902d052053b78dbae258aedce6",()=>f.updateProfileImage,"40a3b9a2f61c8584261559c7f3c9647c55d1d38abe",()=>f.deletePackaging,"40b5ec606dadd81bccf8a8dbc17f166a773179ab91",()=>f.deleteCategory,"40dc9989f36939aabed70c6c2aade45aabe811ce84",()=>f.updateAppLogo,"600eca4aada408c9eb6b461f06c64d529daa06496d",()=>f.createCategory,"608ea7852674dfc3151bd8e7396758508c2f77df01",()=>f.createPackaging]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__a7cb1361._.js.map