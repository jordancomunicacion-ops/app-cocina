module.exports=[37936,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(11857)},13095,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},25982,a=>{"use strict";var b=a.i(53112);let c=b.z.object({id:b.z.string(),name:b.z.string().min(1,{message:"El nombre es obligatorio."}),category:b.z.string().optional(),pricingUnit:b.z.enum(["KG","G","L","ML","UD"]),pricePerUnit:b.z.coerce.number().gt(0,{message:"El precio debe ser mayor a 0."}),yieldPercent:b.z.coerce.number().min(0).max(100,{message:"El rendimiento debe estar entre 0 y 100."}),allergens:b.z.string().optional(),supplierId:b.z.string().optional()}),d=c.omit({id:!0}),e=b.z.object({id:b.z.string().optional(),ingredientId:b.z.string().optional().nullable(),subRecipeId:b.z.string().optional().nullable(),sourceProductId:b.z.string().optional().nullable(),type:b.z.enum(["INGREDIENT","SUB_RECIPE"]),quantityGross:b.z.coerce.number().gt(0,{message:"La cantidad debe ser mayor a 0."}),unit:b.z.enum(["KG","G","L","ML","UD"])}),f=b.z.object({id:b.z.string().optional(),order:b.z.coerce.number(),description:b.z.string().min(1,{message:"La descripción es obligatoria."}),action:b.z.string().optional(),subAction:b.z.string().optional(),ingredientId:b.z.string().optional().nullable()}),g=b.z.object({id:b.z.string(),name:b.z.string().min(1,{message:"El nombre es obligatorio."}),category:b.z.enum(["PRODUCTO_NO_ELABORADO","ELABORACION_INTERMEDIA","ELABORACION_FINAL"]),classification:b.z.string().optional(),packaging:b.z.string().optional(),portions:b.z.preprocess(a=>""===a?null:Number(a),b.z.number().min(1,{message:"Debe ser mayor a 0"}).optional().nullable()),prepTime:b.z.preprocess(a=>""===a?null:Number(a),b.z.number().min(0).optional().nullable()),cookTime:b.z.preprocess(a=>""===a?null:Number(a),b.z.number().min(0).optional().nullable()),yieldQuantity:b.z.coerce.number().gt(0,{message:"El rendimiento debe ser mayor a 0."}),yieldUnit:b.z.enum(["KG","G","L","ML","UD"]).optional(),instructions:b.z.string().optional(),items:b.z.array(e).optional(),steps:b.z.array(f).optional()}),h=g.omit({id:!0}),i=b.z.object({id:b.z.string().optional(),recipeId:b.z.string().min(1,{message:"Debe seleccionar una receta."}),servingsOverride:b.z.coerce.number().optional().nullable()}),j=b.z.object({id:b.z.string(),name:b.z.string().min(1,{message:"El nombre del evento es obligatorio."}),date:b.z.string().transform(a=>new Date(a)),pax:b.z.coerce.number().gt(0,{message:"El número de personas debe ser mayor a 0."}),safetyMargin:b.z.coerce.number().min(1,{message:"El margen debe ser al menos 1.0 (100%)."}),status:b.z.enum(["DRAFT","CONFIRMED","COMPLETED"]).optional(),menuItems:b.z.array(i).optional()}),k=j.omit({id:!0}),l=b.z.object({id:b.z.string(),name:b.z.string().min(1,{message:"El nombre es obligatorio."}),email:b.z.string().email({message:"Email inválido."}),password:b.z.string().min(6,{message:"La contraseña debe tener al menos 6 caracteres."}).optional(),role:b.z.enum(["ADMIN","CHEF","EMPLOYEE"]),firstName:b.z.string().optional(),lastName:b.z.string().optional(),dni:b.z.string().optional(),phone:b.z.string().optional(),jobTitle:b.z.string().optional(),dob:b.z.string().optional()}),m=l.omit({id:!0}).extend({password:b.z.string().min(6,{message:"La contraseña es obligatoria."})}),n=b.z.object({id:b.z.string(),title:b.z.string().min(1,{message:"El título es obligatorio."}),description:b.z.string().optional(),assignedToUserId:b.z.string().optional().nullable(),status:b.z.enum(["PENDING","IN_PROGRESS","DONE","ISSUE"]),recipeId:b.z.string().optional().nullable(),targetQuantity:b.z.coerce.number().optional().nullable(),plannedStart:b.z.string().optional().nullable(),plannedEnd:b.z.string().optional().nullable()}).omit({id:!0,status:!0});a.s(["CreateEventSchema",0,k,"CreateIngredientSchema",0,d,"CreateRecipeSchema",0,h,"CreateTaskSchema",0,n,"CreateUserSchema",0,m,"UpdateEventSchema",0,j,"UpdateIngredientSchema",0,c,"UpdateRecipeSchema",0,g,"UpdateUserSchema",0,l])},82919,a=>a.a(async(b,c)=>{try{var d=a.i(37936),e=a.i(47525);a.i(40522);var f=a.i(9349),g=a.i(25982),h=a.i(44950),i=a.i(63021);a.i(70396);var j=a.i(73727),k=a.i(13095),l=b([e,h]);async function m(a,b){try{await (0,e.signIn)("credentials",{...Object.fromEntries(b),redirectTo:"/dashboard"})}catch(a){if(console.error("Auth Error:",a),a instanceof f.AuthError){if(console.error("Auth Error Type:",a.type),"CredentialsSignin"===a.type)return"Invalid credentials.";return"Something went wrong."}throw a}}async function n(){await (0,e.signOut)()}[e,h]=l.then?(await l)():l;let p=new i.PrismaClient;async function o(a,b){let c=g.CreateUserSchema.safeParse({name:b.get("name"),email:b.get("email"),password:b.get("password"),role:b.get("role")});if(!c.success)return{errors:c.error.flatten().fieldErrors,message:"Faltan campos obligatorios. Error al registrar usuario."};let{name:d,email:e,password:f,role:i}=c.data,k=await h.default.hash(f,10);try{await p.user.create({data:{name:d,email:e,password:k,role:i}})}catch(a){if("P2002"===a.code)return{message:"El email ya está uso."};return{message:"Error de base de datos: Error al registrar usuario."}}(0,j.redirect)("/login")}(0,k.ensureServerEntryExports)([m,n,o]),(0,d.registerServerReference)(m,"60adfdadc4b7b21a8f0a83aa2edaa389f39f0e987d",null),(0,d.registerServerReference)(n,"007ee69180cc5dfd929eff6368f4b57b396a0cb651",null),(0,d.registerServerReference)(o,"60622933cf9ec826cda69d3234a9eefe6e39396909",null),a.s(["authenticate",()=>m,"registerUser",()=>o,"signOutAction",()=>n]),c()}catch(a){c(a)}},!1),41051,a=>{"use strict";var b=a.i(37936),c=a.i(53112),d=a.i(73794),e=a.i(18558);a.i(70396);var f=a.i(73727),g=a.i(13095);let h=c.z.object({ingredientId:c.z.string().optional(),newIngredientName:c.z.string().optional(),weight:c.z.coerce.number().min(0),costAllocation:c.z.coerce.number().min(0).default(1)}).refine(a=>a.ingredientId||a.newIngredientName&&""!==a.newIngredientName.trim(),{message:"Debe seleccionar un ingrediente o escribir un nombre nuevo."}),i=c.z.object({sourceProductId:c.z.string(),name:c.z.string().min(1,"El nombre es obligatorio"),testQuantity:c.z.coerce.number().gt(0,"La cantidad del test debe ser mayor a 0"),outputs:c.z.array(h).min(1,"Debe haber al menos una salida (aunque sea merma)")}),j=i.extend({id:c.z.string()});async function k(a,b){let c=b.get("outputs"),g=c?JSON.parse(c):[],h=i.safeParse({sourceProductId:b.get("sourceProductId"),name:b.get("name"),testQuantity:Number(b.get("testQuantity")),outputs:g});if(!h.success)return{errors:h.error.flatten().fieldErrors,message:"Error de validación. Revise los datos."};let{sourceProductId:j,name:k,testQuantity:l,outputs:m}=h.data;try{await d.prisma.$transaction(async a=>{let b=await a.transformation.create({data:{name:k,sourceProductId:j}});for(let c of m){let d=c.ingredientId;if(!d&&c.newIngredientName){let b=c.newIngredientName.trim(),e=await a.ingredient.findFirst({where:{name:{equals:b,mode:"insensitive"}}});d=e?e.id:(await a.ingredient.create({data:{name:b,pricePerUnit:0}})).id}if(d){let e=c.weight/l*100;await a.transformationOutput.create({data:{transformationId:b.id,ingredientId:d,percentage:e,costAllocation:c.costAllocation}})}}})}catch(a){return console.error(a),{message:"Error al guardar la transformación."}}(0,e.revalidatePath)(`/dashboard/products/${j}`),(0,f.redirect)(`/dashboard/products/${j}`)}async function l(a,b,c){let g=c.get("outputs"),h=g?JSON.parse(g):[],i=j.safeParse({id:a,sourceProductId:c.get("sourceProductId"),name:c.get("name"),testQuantity:Number(c.get("testQuantity")),outputs:h});if(!i.success)return{errors:i.error.flatten().fieldErrors,message:"Error de validación. Revise los datos."};let{sourceProductId:k,name:l,testQuantity:m,outputs:n}=i.data;try{await d.prisma.$transaction(async b=>{for(let c of(await b.transformation.update({where:{id:a},data:{name:l}}),await b.transformationOutput.deleteMany({where:{transformationId:a}}),n)){let d=c.ingredientId;if(!d&&c.newIngredientName){let a=c.newIngredientName.trim(),e=await b.ingredient.findFirst({where:{name:{equals:a,mode:"insensitive"}}});d=e?e.id:(await b.ingredient.create({data:{name:a,pricePerUnit:0}})).id}if(d){let e=c.weight/m*100;await b.transformationOutput.create({data:{transformationId:a,ingredientId:d,percentage:e,costAllocation:c.costAllocation}})}}})}catch(a){return console.error(a),{message:"Error al actualizar la transformación."}}(0,e.revalidatePath)(`/dashboard/products/${k}`),(0,f.redirect)(`/dashboard/products/${k}`)}async function m(a){try{await d.prisma.transformation.delete({where:{id:a}})}catch(a){return{message:"Error de base de datos: No se pudo borrar la transformación."}}return(0,e.revalidatePath)("/dashboard/products"),{message:"Transformación eliminada correctamente"}}(0,g.ensureServerEntryExports)([k,l,m]),(0,b.registerServerReference)(k,"607c479d2ed2c12eeb77398a26cf33bad91b087e8b",null),(0,b.registerServerReference)(l,"70e8fa4537bed9a50115d141b35f05b3c16fb7b82b",null),(0,b.registerServerReference)(m,"40c7ed7dfe588208a7946c94fbfec30cfec72b50ea",null),a.s(["createTransformation",()=>k,"deleteTransformation",()=>m,"updateTransformation",()=>l])},82212,a=>a.a(async(b,c)=>{try{var d=a.i(82919);a.i(41051);var e=b([d]);[d]=e.then?(await e)():e,a.s([]),c()}catch(a){c(a)}},!1),79711,a=>a.a(async(b,c)=>{try{var d=a.i(82212),e=a.i(82919),f=a.i(41051),g=b([d,e]);[d,e]=g.then?(await g)():g,a.s(["007ee69180cc5dfd929eff6368f4b57b396a0cb651",()=>e.signOutAction,"40c7ed7dfe588208a7946c94fbfec30cfec72b50ea",()=>f.deleteTransformation,"607c479d2ed2c12eeb77398a26cf33bad91b087e8b",()=>f.createTransformation,"70e8fa4537bed9a50115d141b35f05b3c16fb7b82b",()=>f.updateTransformation]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=_97f5c0a9._.js.map