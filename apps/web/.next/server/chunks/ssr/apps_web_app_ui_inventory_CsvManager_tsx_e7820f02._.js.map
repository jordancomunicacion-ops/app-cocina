{"version":3,"sources":["../../../../../../apps/web/app/ui/inventory/CsvManager.tsx","../../../../../../node_modules/%40heroicons/react/24/outline/esm/ArrowDownTrayIcon.js","../../../../../../node_modules/%40heroicons/react/24/outline/esm/ArrowUpTrayIcon.js"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useRef } from 'react';\r\nimport { ArrowDownTrayIcon, ArrowUpTrayIcon } from '@heroicons/react/24/outline';\r\n\r\nexport function CsvManager() {\r\n    const [isUploading, setIsUploading] = useState(false);\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n    const downloadTemplate = () => {\r\n        const headers = ['Nombre', 'Categoria', 'Unidad (KG/L/UD)', 'Precio', 'Rendimiento (%)', 'Alergenos (Separados por coma)'];\r\n        const rows = [\r\n            ['Tomate Pera', 'Verduras', 'KG', '1.50', '100', ''],\r\n            ['Harina Trigo', 'Secos', 'KG', '0.80', '100', 'Gluten'],\r\n        ];\r\n\r\n        const csvContent = [\r\n            headers.join(','),\r\n            ...rows.map(row => row.join(','))\r\n        ].join('\\n');\r\n\r\n        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\r\n        const url = URL.createObjectURL(blob);\r\n        const link = document.createElement('a');\r\n        link.href = url;\r\n        link.setAttribute('download', 'plantilla_productos.csv');\r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n    };\r\n\r\n    const handleUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        setIsUploading(true);\r\n        const reader = new FileReader();\r\n\r\n        reader.onload = async (event) => {\r\n            const text = event.target?.result as string;\r\n            if (!text) return;\r\n\r\n            const lines = text.split(/\\r?\\n/);\r\n            const data = lines.slice(1).map(line => {\r\n                // Better CSV parsing to handle basic quoted strings if needed, \r\n                // but for now simple split with robust cleanup\r\n                const parts = line.split(',');\r\n                if (parts.length < 4) return null; // Skip empty or invalid lines\r\n\r\n                const [name, category, pricingUnit, pricePerUnit, yieldPercent, allergens] = parts;\r\n\r\n                return {\r\n                    name: name?.trim(),\r\n                    category: category?.trim() || 'Otros',\r\n                    pricingUnit: pricingUnit?.trim() || 'KG',\r\n                    pricePerUnit: parseFloat(pricePerUnit?.trim() || '0'),\r\n                    yieldPercent: parseFloat(yieldPercent?.trim() || '100'),\r\n                    allergens: allergens ? allergens.replace(/\"/g, '').split(';').map(s => s.trim()) : []\r\n                };\r\n            }).filter(item => item && item.name);\r\n\r\n            try {\r\n                const res = await fetch('/api/products/batch', {\r\n                    method: 'POST',\r\n                    body: JSON.stringify(data),\r\n                    headers: { 'Content-Type': 'application/json' }\r\n                });\r\n\r\n                if (res.ok) {\r\n                    const result = await res.json();\r\n                    alert(`Se han cargado ${result.count} productos correctamente.`);\r\n                    window.location.reload();\r\n                } else {\r\n                    alert('Error al cargar productos. Verifique el formato del CSV.');\r\n                }\r\n            } catch (error) {\r\n                console.error(error);\r\n                alert('Error de conexi√≥n con el servidor.');\r\n            } finally {\r\n                setIsUploading(false);\r\n                if (fileInputRef.current) fileInputRef.current.value = '';\r\n            }\r\n        };\r\n\r\n        reader.readAsText(file);\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex gap-2\">\r\n            <button\r\n                onClick={downloadTemplate}\r\n                className=\"flex items-center gap-2 px-4 py-2 bg-white border border-blue-200 text-blue-700 rounded-md hover:bg-blue-50 text-sm font-medium shadow-sm transition-colors\"\r\n                title=\"Descargar plantilla CSV\"\r\n            >\r\n                <ArrowDownTrayIcon className=\"w-5 h-5\" />\r\n                <span className=\"hidden sm:inline\">Plantilla CSV</span>\r\n            </button>\r\n\r\n            <input\r\n                type=\"file\"\r\n                id=\"csv-upload\"\r\n                ref={fileInputRef}\r\n                onChange={handleUpload}\r\n                accept=\".csv\"\r\n                className=\"hidden\"\r\n            />\r\n\r\n            <label\r\n                htmlFor=\"csv-upload\"\r\n                className={`flex items-center gap-2 px-4 py-2 bg-white border border-blue-200 text-blue-700 rounded-md hover:bg-blue-50 text-sm font-medium shadow-sm transition-colors cursor-pointer ${isUploading ? 'opacity-50 cursor-not-allowed' : ''}`}\r\n            >\r\n                <ArrowUpTrayIcon className=\"w-5 h-5\" />\r\n                <span className=\"hidden sm:inline\">{isUploading ? 'Cargando...' : 'Cargar CSV'}</span>\r\n            </label>\r\n        </div>\r\n    );\r\n}\r\n","import * as React from \"react\";\nfunction ArrowDownTrayIcon({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", Object.assign({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    fill: \"none\",\n    viewBox: \"0 0 24 24\",\n    strokeWidth: 1.5,\n    stroke: \"currentColor\",\n    \"aria-hidden\": \"true\",\n    \"data-slot\": \"icon\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, /*#__PURE__*/React.createElement(\"path\", {\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\",\n    d: \"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3\"\n  }));\n}\nconst ForwardRef = /*#__PURE__*/ React.forwardRef(ArrowDownTrayIcon);\nexport default ForwardRef;","import * as React from \"react\";\nfunction ArrowUpTrayIcon({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", Object.assign({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    fill: \"none\",\n    viewBox: \"0 0 24 24\",\n    strokeWidth: 1.5,\n    stroke: \"currentColor\",\n    \"aria-hidden\": \"true\",\n    \"data-slot\": \"icon\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, /*#__PURE__*/React.createElement(\"path\", {\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\",\n    d: \"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5\"\n  }));\n}\nconst ForwardRef = /*#__PURE__*/ React.forwardRef(ArrowUpTrayIcon);\nexport default ForwardRef;"],"names":[],"mappings":"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","ignoreList":[1,2]}