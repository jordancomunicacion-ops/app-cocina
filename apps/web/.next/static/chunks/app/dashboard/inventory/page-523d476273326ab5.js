(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4454],{968:(e,t,r)=>{Promise.resolve().then(r.bind(r,4141)),Promise.resolve().then(r.t.bind(r,5587,23))},4141:(e,t,r)=>{"use strict";r.d(t,{CsvManager:()=>i});var a=r(4568),n=r(7620);let l=n.forwardRef(function({title:e,titleId:t,...r},a){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},r),e?n.createElement("title",{id:t},e):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"}))}),o=n.forwardRef(function({title:e,titleId:t,...r},a){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},r),e?n.createElement("title",{id:t},e):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5"}))});function i(){let[e,t]=(0,n.useState)(!1),r=(0,n.useRef)(null),i=async e=>{let a=e.target.files?.[0];if(!a)return;t(!0);let n=new FileReader;n.onload=async e=>{let a=e.target?.result;if(!a)return;let n=a.split(/\r?\n/).slice(1).map(e=>{let t=e.split(",");if(t.length<4)return null;let[r,a,n,l,o,i]=t;return{name:r?.trim(),category:a?.trim()||"Otros",pricingUnit:n?.trim()||"KG",pricePerUnit:parseFloat(l?.trim()||"0"),yieldPercent:parseFloat(o?.trim()||"100"),allergens:i?i.replace(/"/g,"").split(";").map(e=>e.trim()):[]}}).filter(e=>e&&e.name);try{let e=await fetch("/api/products/batch",{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}});if(e.ok){let t=await e.json();alert(`Se han cargado ${t.count} productos correctamente.`),window.location.reload()}else alert("Error al cargar productos. Verifique el formato del CSV.")}catch(e){console.error(e),alert("Error de conexi\xf3n con el servidor.")}finally{t(!1),r.current&&(r.current.value="")}},n.readAsText(a)};return(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("button",{onClick:()=>{let e=new Blob([["Nombre,Categoria,Unidad (KG/L/UD),Precio,Rendimiento (%),Alergenos (Separados por coma)",...[["Tomate Pera","Verduras","KG","1.50","100",""],["Harina Trigo","Secos","KG","0.80","100","Gluten"]].map(e=>e.join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.setAttribute("download","plantilla_productos.csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r)},className:"flex items-center gap-2 px-4 py-2 bg-white border border-blue-200 text-blue-700 rounded-md hover:bg-blue-50 text-sm font-medium shadow-sm transition-colors",title:"Descargar plantilla CSV",children:[(0,a.jsx)(l,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Plantilla CSV"})]}),(0,a.jsx)("input",{type:"file",id:"csv-upload",ref:r,onChange:i,accept:".csv",className:"hidden"}),(0,a.jsxs)("label",{htmlFor:"csv-upload",className:`flex items-center gap-2 px-4 py-2 bg-white border border-blue-200 text-blue-700 rounded-md hover:bg-blue-50 text-sm font-medium shadow-sm transition-colors cursor-pointer ${e?"opacity-50 cursor-not-allowed":""}`,children:[(0,a.jsx)(o,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:e?"Cargando...":"Cargar CSV"})]})]})}}},e=>{e.O(0,[5587,587,1968,7358],()=>e(e.s=968)),_N_E=e.O()}]);