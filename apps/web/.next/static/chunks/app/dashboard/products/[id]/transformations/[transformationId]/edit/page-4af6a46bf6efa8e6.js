(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[955],{2362:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});var s=a(7620);let r=s.forwardRef(function({title:e,titleId:t,...a},r){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},a),e?s.createElement("title",{id:t},e):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))})},4378:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});var s=a(7620);let r=s.forwardRef(function({title:e,titleId:t,...a},r){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},a),e?s.createElement("title",{id:t},e):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))})},5645:(e,t,a)=>{Promise.resolve().then(a.bind(a,8888))},5974:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s={callServer:function(){return n.callServer},createServerReference:function(){return i.createServerReference},findSourceMapURL:function(){return l.findSourceMapURL}};for(var r in s)Object.defineProperty(t,r,{enumerable:!0,get:s[r]});let n=a(4273),l=a(6409),i=a(7102)},8888:(e,t,a)=>{"use strict";a.d(t,{default:()=>o});var s=a(4568),r=a(5974);let n=(0,r.createServerReference)("7049575342ea0ff1bb31f21818e531a4efc6f7f40f",r.callServer,void 0,r.findSourceMapURL,"updateTransformation");var l=a(7620),i=a(4378),d=a(2362);function o({product:e,transformation:t,ingredients:a}){let r=n.bind(null,t.id),[o,c]=(0,l.useActionState)(r,{message:null,errors:{}}),[m,u]=(0,l.useState)(1),[p,x]=(0,l.useState)(t.outputs.map(e=>({key:e.id,ingredientId:e.ingredientId,newIngredientName:e.ingredient.name,weight:e.percentage*m/100,costAllocation:e.costAllocation}))),g=(e,t,a)=>{let s=[...p];s[e]={...s[e],[t]:a},x(s)},h=p.reduce((e,t)=>e+(Number(t.weight)||0),0),f=m>0?h/m*100:0;return(0,s.jsxs)("form",{action:c,children:[(0,s.jsx)("input",{type:"hidden",name:"sourceProductId",value:e.id}),(0,s.jsx)("input",{type:"hidden",name:"outputs",value:JSON.stringify(p)}),(0,s.jsxs)("div",{className:"rounded-md bg-gray-50 p-4 md:p-6 mb-6",children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Nombre de la Transformaci\xf3n"}),(0,s.jsx)("input",{name:"name",type:"text",defaultValue:t.name,placeholder:"Ej. Limpieza Standard...",className:"w-full rounded-md border-gray-200 py-2 pl-4 text-sm"})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Cantidad Base para C\xe1lculo"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{name:"testQuantity",type:"number",step:"any",value:m,onChange:e=>{u(parseFloat(e.target.value))},className:"w-32 rounded-md border-gray-200 py-2 pl-4 text-sm"}),(0,s.jsx)("span",{className:"font-bold text-gray-600",children:e.unit})]}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"* Al editar, por defecto usaremos cantidad 1 para mostrar los rendimientos como proporci\xf3n."})]})]}),(0,s.jsxs)("div",{className:"rounded-md bg-white border border-gray-200 p-4 md:p-6 shadow-sm",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-bold",children:"Desglose (Salidas)"}),(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsxs)("span",{className:`font-bold ${1>Math.abs(100-f)?"text-green-600":"text-orange-500"}`,children:["Rendimiento Total: ",f.toFixed(1),"%"]}),(0,s.jsx)("span",{className:"text-gray-400 mx-2",children:"|"}),(0,s.jsxs)("span",{children:["Total Peso: ",h.toFixed(3)," ",e.unit]})]})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"grid grid-cols-12 gap-2 text-xs font-semibold text-gray-500 uppercase",children:[(0,s.jsx)("div",{className:"col-span-5",children:"Ingrediente Resultante"}),(0,s.jsx)("div",{className:"col-span-2",children:"Peso Obtenido"}),(0,s.jsx)("div",{className:"col-span-2",children:"Factor Coste"}),(0,s.jsx)("div",{className:"col-span-2",children:"Rendimiento"}),(0,s.jsx)("div",{className:"col-span-1"})]}),p.map((e,t)=>{let r=Number(e.weight)||0,n=m>0?r/m*100:0;return(0,s.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-center bg-gray-50 p-2 rounded",children:[(0,s.jsxs)("div",{className:"col-span-5",children:[(0,s.jsx)("input",{type:"text",list:`ingredients-${t}`,className:"w-full rounded border-gray-200 text-sm py-1",value:e.newIngredientName,onChange:e=>g(t,"newIngredientName",e.target.value)}),(0,s.jsx)("datalist",{id:`ingredients-${t}`,children:a.map(e=>{let t=e.name;if(e.transformationOutputs&&e.transformationOutputs.length>0&&e.transformationOutputs[0].transformation?.sourceProduct){let a=e.transformationOutputs[0].transformation.sourceProduct.name;t.toLowerCase().includes(a.toLowerCase())||(t=`${a} - ${e.name}`)}return(0,s.jsx)("option",{value:t},e.id)})})]}),(0,s.jsx)("div",{className:"col-span-2",children:(0,s.jsx)("input",{type:"number",step:"any",className:"w-full rounded border-gray-200 text-sm py-1",value:e.weight,onChange:e=>g(t,"weight",""===e.target.value?"":parseFloat(e.target.value))})}),(0,s.jsx)("div",{className:"col-span-2",children:(0,s.jsx)("input",{type:"number",step:"0.1",className:"w-full rounded border-gray-200 text-sm py-1",value:e.costAllocation,onChange:e=>g(t,"costAllocation",""===e.target.value?"":parseFloat(e.target.value))})}),(0,s.jsxs)("div",{className:"col-span-2 text-center text-sm font-medium",children:[n.toFixed(1),"%"]}),(0,s.jsx)("div",{className:"col-span-1 flex justify-end",children:(0,s.jsx)("button",{type:"button",onClick:()=>{let e;(e=[...p]).splice(t,1),x(e)},className:"text-red-500 hover:text-red-700",children:(0,s.jsx)(i.A,{className:"w-5"})})})]},e.key)})]}),(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsxs)("button",{type:"button",onClick:()=>{x([...p,{key:crypto.randomUUID(),ingredientId:"",newIngredientName:"",weight:"",costAllocation:1}])},className:"flex items-center gap-1 text-sm text-blue-600 font-medium",children:[(0,s.jsx)(d.A,{className:"w-4"})," A\xf1adir Salida"]})})]}),(0,s.jsx)("div",{"aria-live":"polite","aria-atomic":"true",className:"mt-4",children:o.message&&(0,s.jsx)("p",{className:"text-sm text-red-500",children:o.message})}),(0,s.jsx)("div",{className:"mt-6 flex justify-end gap-4",children:(0,s.jsx)("button",{type:"submit",className:"flex h-10 items-center rounded-lg bg-blue-600 px-4 text-sm font-medium text-white transition-colors hover:bg-blue-500",children:"Guardar Cambios"})})]})}}},e=>{e.O(0,[587,1968,7358],()=>e(e.s=5645)),_N_E=e.O()}]);