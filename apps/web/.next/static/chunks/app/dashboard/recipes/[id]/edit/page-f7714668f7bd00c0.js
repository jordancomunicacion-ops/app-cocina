(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1946],{993:(e,r,t)=>{Promise.resolve().then(t.bind(t,4473)),Promise.resolve().then(t.t.bind(t,5587,23))},2362:(e,r,t)=>{"use strict";t.d(r,{A:()=>i});var a=t(7620);let i=a.forwardRef(function({title:e,titleId:r,...t},i){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":r},t),e?a.createElement("title",{id:r},e):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))})},4378:(e,r,t)=>{"use strict";t.d(r,{A:()=>i});var a=t(7620);let i=a.forwardRef(function({title:e,titleId:r,...t},i){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":r},t),e?a.createElement("title",{id:r},e):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))})},4473:(e,r,t)=>{"use strict";t.d(r,{default:()=>u});var a=t(4568),i=t(5974);let l=(0,i.createServerReference)("7000869694e9efc7a96618fd4ac0dc94300f6621ab",i.callServer,void 0,i.findSourceMapURL,"updateRecipe");var s=t(5587),n=t.n(s),d=t(2362),o=t(4378),c=t(7620);let m={KG:1,G:.001,L:1,ML:.001,UD:1};function u({recipe:e,ingredients:r,categories:t,packaging:i,availableSubRecipes:s=[]}){let u=l.bind(null,e.id),[p,x]=(0,c.useActionState)(u,{message:null,errors:{}}),[h,b]=(0,c.useState)(e.yieldQuantity||1),[g,j]=(0,c.useState)(e.items.map(e=>({key:e.id,id:e.id,type:e.type,ingredientId:e.ingredientId||"",subRecipeId:e.subRecipeId||"",sourceProductId:e.sourceProductId||"",quantityGross:e.quantityGross,unit:e.unit}))),y=(e,r,t)=>{let a=[...g];a[e]={...a[e],[r]:t},"ingredientId"===r&&(a[e].sourceProductId=""),j(a)},[f,v]=(0,c.useState)((e.steps||[]).sort((e,r)=>e.order-r.order).map(e=>({key:e.id,order:e.order,description:e.description,action:e.action||"",subAction:e.subAction||"",ingredientId:e.ingredientId||""}))),N={CORTAR:["Brunoisse","Juliana","Mirepoix","Rodajas","Gajos"],DESPIEZAR:["Filetear","Picar","Limpiar","Deshuesar"],COCCION:["Directa","Indirecta","Al vac\xedo","Hervir","Sofre\xedr","Asar"],MEZCLAR:["Batir","Remover","Amasar"],OTROS:["Marinar","Reposar","Emplatar"]},k=(e,r,t)=>{let a=[...f];a[e]={...a[e],[r]:t},"action"===r&&(a[e].subAction=""),v(a)},w=g.reduce((e,t)=>{if("INGREDIENT"===t.type&&t.ingredientId){let s=r.find(e=>e.id===t.ingredientId);if(s){var a,i,l;let r=(a=t.quantityGross,(i=t.unit)===(l=s.pricingUnit)?a:("KG"===i||"G"===i)&&("KG"===l||"G"===l)||("L"===i||"ML"===i)&&("L"===l||"ML"===l)?a*m[i]/m[l]:"UD"===i&&"UD"===l?a:null);if(null!==r)return e+r*s.pricePerUnit}}return e},0),I=g.map(e=>{let t=r.find(r=>r.id===e.ingredientId);return t?{id:t.id,name:t.name}:null}).filter(Boolean);return(0,a.jsxs)("form",{action:x,children:[(0,a.jsxs)("div",{className:"rounded-md bg-gray-50 p-4 md:p-6",children:[(0,a.jsxs)("div",{className:"mb-6 grid grid-cols-2 gap-4 rounded-lg bg-blue-50 p-4 border border-blue-100",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-blue-600 font-semibold",children:"Coste Total Receta"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-blue-800",children:new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(w)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-green-600 font-semibold",children:"Coste por Raci\xf3n/Unidad"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-green-800",children:new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(h>0?w/h:0)})]})]}),(0,a.jsx)("input",{type:"hidden",name:"items",value:JSON.stringify(g)}),(0,a.jsx)("input",{type:"hidden",name:"steps",value:JSON.stringify(f)}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{htmlFor:"name",className:"mb-2 block text-sm font-medium",children:"Nombre de la Receta"}),(0,a.jsxs)("div",{className:"relative mt-2 rounded-md",children:[(0,a.jsx)("input",{id:"name",name:"name",type:"text",defaultValue:e.name,placeholder:"Ej. Salsa Bolo\xf1esa",className:"peer block w-full rounded-md border border-gray-200 py-2 pl-4 text-sm outline-2 placeholder:text-gray-500","aria-describedby":"name-error"}),(0,a.jsx)("div",{id:"name-error","aria-live":"polite","aria-atomic":"true",children:p.errors?.name&&p.errors.name.map(e=>(0,a.jsx)("p",{className:"mt-2 text-sm text-red-500",children:e},e))})]})]}),(0,a.jsxs)("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-3 gap-4 border-b pb-6 border-gray-200",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"classification",className:"mb-2 block text-sm font-medium",children:"Clasificaci\xf3n"}),(0,a.jsxs)("select",{id:"classification",name:"classification",className:"peer block w-full rounded-md border border-gray-200 py-2 pl-4 text-sm outline-2 placeholder:text-gray-500",defaultValue:e.classification||"",children:[(0,a.jsx)("option",{value:"",disabled:!0,children:"Seleccionar Clasificaci\xf3n..."}),t.map(e=>(0,a.jsx)("option",{value:e.name,children:e.name},e.id))]}),(0,a.jsx)("div",{id:"classification-error","aria-live":"polite","aria-atomic":"true",children:p.errors?.classification&&p.errors.classification.map(e=>(0,a.jsx)("p",{className:"mt-2 text-sm text-red-500",children:e},e))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"category",className:"mb-2 block text-sm font-medium",children:"Tipo de Receta"}),(0,a.jsxs)("select",{id:"category",name:"category",className:"peer block w-full rounded-md border border-gray-200 py-2 pl-4 text-sm outline-2 placeholder:text-gray-500",defaultValue:e.category||"ELABORACION_FINAL",children:[(0,a.jsx)("option",{value:"PRODUCTO_NO_ELABORADO",children:"Producto No Elaborado"}),(0,a.jsx)("option",{value:"ELABORACION_INTERMEDIA",children:"Elaboraci\xf3n Intermedia"}),(0,a.jsx)("option",{value:"ELABORACION_FINAL",children:"Elaboraci\xf3n Final"})]}),(0,a.jsx)("div",{id:"category-error","aria-live":"polite","aria-atomic":"true",children:p.errors?.category&&p.errors.category.map(e=>(0,a.jsx)("p",{className:"mt-2 text-sm text-red-500",children:e},e))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"packaging",className:"mb-2 block text-sm font-medium",children:"Envasado / Molde"}),(0,a.jsxs)("select",{id:"packaging",name:"packaging",defaultValue:e.packaging||"",className:"peer block w-full rounded-md border border-gray-200 py-2 pl-4 text-sm outline-2 placeholder:text-gray-500",children:[(0,a.jsx)("option",{value:"",children:"Seleccionar Envase..."}),i.map(e=>(0,a.jsx)("option",{value:e.name,children:e.name},e.id))]}),(0,a.jsx)("div",{id:"packaging-error","aria-live":"polite","aria-atomic":"true",children:p.errors?.packaging&&p.errors.packaging.map(e=>(0,a.jsx)("p",{className:"mt-2 text-sm text-red-500",children:e},e))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"portions",className:"mb-2 block text-sm font-medium",children:"N\xba Raciones"}),(0,a.jsx)("input",{id:"portions",name:"portions",type:"number",defaultValue:e.portions||"",placeholder:"Ej. 36",className:"peer block w-full rounded-md border border-gray-200 py-2 pl-4 text-sm placeholder:text-gray-500"}),(0,a.jsx)("div",{id:"portions-error","aria-live":"polite","aria-atomic":"true",children:p.errors?.portions&&p.errors.portions.map(e=>(0,a.jsx)("p",{className:"mt-2 text-sm text-red-500",children:e},e))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"prepTime",className:"mb-2 block text-sm font-medium",children:"Tiempo Preparaci\xf3n (mins)"}),(0,a.jsx)("input",{id:"prepTime",name:"prepTime",type:"number",defaultValue:e.prepTime||"",placeholder:"15",className:"peer block w-full rounded-md border border-gray-200 py-2 pl-4 text-sm placeholder:text-gray-500"}),(0,a.jsx)("div",{id:"prepTime-error","aria-live":"polite","aria-atomic":"true",children:p.errors?.prepTime&&p.errors.prepTime.map(e=>(0,a.jsx)("p",{className:"mt-2 text-sm text-red-500",children:e},e))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"cookTime",className:"mb-2 block text-sm font-medium",children:"Tiempo Cocci\xf3n (mins)"}),(0,a.jsx)("input",{id:"cookTime",name:"cookTime",type:"number",defaultValue:e.cookTime||"",placeholder:"27",className:"peer block w-full rounded-md border border-gray-200 py-2 pl-4 text-sm placeholder:text-gray-500"}),(0,a.jsx)("div",{id:"cookTime-error","aria-live":"polite","aria-atomic":"true",children:p.errors?.cookTime&&p.errors.cookTime.map(e=>(0,a.jsx)("p",{className:"mt-2 text-sm text-red-500",children:e},e))})]})]}),(0,a.jsxs)("div",{className:"mb-4 grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"yieldQuantity",className:"mb-2 block text-sm font-medium",children:"Rendimiento (Cantidad)"}),(0,a.jsx)("input",{id:"yieldQuantity",name:"yieldQuantity",type:"number",step:"0.01",defaultValue:e.yieldQuantity,onChange:e=>b(parseFloat(e.target.value)||0),className:"peer block w-full rounded-md border border-gray-200 py-2 pl-4 text-sm outline-2 placeholder:text-gray-500"}),(0,a.jsx)("div",{id:"yieldQuantity-error","aria-live":"polite","aria-atomic":"true",children:p.errors?.yieldQuantity&&p.errors.yieldQuantity.map(e=>(0,a.jsx)("p",{className:"mt-2 text-sm text-red-500",children:e},e))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"yieldUnit",className:"mb-2 block text-sm font-medium",children:"Unidad"}),(0,a.jsxs)("select",{id:"yieldUnit",name:"yieldUnit",className:"peer block w-full rounded-md border border-gray-200 py-2 pl-4 text-sm outline-2 placeholder:text-gray-500",defaultValue:e.yieldUnit||"KG",children:[(0,a.jsx)("option",{value:"KG",children:"KG"}),(0,a.jsx)("option",{value:"L",children:"L"}),(0,a.jsx)("option",{value:"UD",children:"Raciones / Unidades"})]}),(0,a.jsx)("div",{id:"yieldUnit-error","aria-live":"polite","aria-atomic":"true",children:p.errors?.yieldUnit&&p.errors.yieldUnit.map(e=>(0,a.jsx)("p",{className:"mt-2 text-sm text-red-500",children:e},e))})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{htmlFor:"instructions",className:"mb-2 block text-sm font-medium",children:"Notas"}),(0,a.jsx)("textarea",{id:"instructions",name:"instructions",rows:3,defaultValue:e.instructions||"",className:"peer block w-full rounded-md border border-gray-200 py-2 pl-4 text-sm outline-2 placeholder:text-gray-500"})]}),(0,a.jsxs)("div",{className:"mb-4 mt-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("h3",{className:"text-lg font-bold",children:"Ingredientes"}),(0,a.jsxs)("button",{type:"button",onClick:()=>{j([...g,{key:crypto.randomUUID(),type:"INGREDIENT",ingredientId:"",subRecipeId:"",sourceProductId:"",quantityGross:0,unit:"KG"}])},className:"flex items-center gap-1 rounded bg-blue-100 px-3 py-1 text-sm text-blue-600 hover:bg-blue-200",children:[(0,a.jsx)(d.A,{className:"w-4"})," A\xf1adir Item"]})]}),0===g.length&&(0,a.jsx)("p",{className:"text-gray-500 italic text-sm",children:"No hay ingredientes a\xf1adidos."}),(0,a.jsx)("div",{className:"space-y-2",children:g.map((e,t)=>{let i;return(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-2 items-start md:items-center p-3 bg-white rounded border border-gray-200",children:[(0,a.jsx)("div",{className:"w-full md:w-32",children:(0,a.jsxs)("select",{className:"block w-full rounded-md border-gray-200 text-sm font-medium",value:e.type,onChange:e=>{let r=e.target.value,a=[...g];a[t]={...a[t],type:r,ingredientId:"",subRecipeId:"",sourceProductId:""},j(a)},children:[(0,a.jsx)("option",{value:"INGREDIENT",children:"Ingrediente"}),(0,a.jsx)("option",{value:"SUB_RECIPE",children:"Sub-Receta"})]})}),(0,a.jsx)("div",{className:"flex-grow w-full md:w-auto",children:"INGREDIENT"===e.type?(0,a.jsxs)("select",{className:"block w-full rounded-md border-gray-200 text-sm",value:e.ingredientId,onChange:e=>y(t,"ingredientId",e.target.value),children:[(0,a.jsx)("option",{value:"",children:"Seleccionar Ingrediente..."}),r.map(e=>{let r=e.name,t=e.transformationOutputs?.map(e=>e.transformation.sourceProduct.name);if(t&&t.length>0){let a=Array.from(new Set(t));r=`${a.join(" / ")} - ${e.name}`}return(0,a.jsxs)("option",{value:e.id,children:[r," (",e.pricingUnit,")"]},e.id)})]}):(0,a.jsxs)("select",{className:"block w-full rounded-md border-gray-200 text-sm",value:e.subRecipeId,onChange:e=>y(t,"subRecipeId",e.target.value),children:[(0,a.jsx)("option",{value:"",children:"Seleccionar Sub-Receta..."}),s.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})}),(i=r.find(r=>r.id===e.ingredientId))&&i.transformationOutputs&&i.transformationOutputs.length>0?(0,a.jsx)("div",{className:"flex-grow w-full md:w-auto",children:(0,a.jsxs)("select",{className:"block w-full rounded-md border-gray-200 text-sm text-gray-600",value:e.sourceProductId||"",onChange:e=>y(t,"sourceProductId",e.target.value),children:[(0,a.jsx)("option",{value:"",children:"-- Origen Gen\xe9rico --"}),i.transformationOutputs.map(e=>(0,a.jsxs)("option",{value:e.transformation.sourceProduct.id,children:[e.transformation.sourceProduct.supplier?`${e.transformation.sourceProduct.supplier} - `:"",e.transformation.sourceProduct.name," (",e.percentage.toFixed(0),"%)"]},e.transformation.sourceProduct.id))]})}):null,(0,a.jsx)("div",{className:"w-full md:w-24",children:(0,a.jsx)("input",{type:"number",step:"any",placeholder:"Cant.",className:"block w-full rounded-md border-gray-200 text-sm",value:e.quantityGross,onChange:e=>y(t,"quantityGross",parseFloat(e.target.value))})}),(0,a.jsx)("div",{className:"w-full md:w-24",children:(0,a.jsxs)("select",{className:"block w-full rounded-md border-gray-200 text-sm",value:e.unit,onChange:e=>y(t,"unit",e.target.value),children:[(0,a.jsx)("option",{value:"KG",children:"KG"}),(0,a.jsx)("option",{value:"G",children:"G"}),(0,a.jsx)("option",{value:"L",children:"L"}),(0,a.jsx)("option",{value:"ML",children:"ML"}),(0,a.jsx)("option",{value:"UD",children:"UD"})]})}),(0,a.jsx)("button",{type:"button",onClick:()=>{let e;(e=[...g]).splice(t,1),j(e)},className:"text-red-500 hover:text-red-700 p-1",children:(0,a.jsx)(o.A,{className:"w-5"})})]},e.key)})})]}),(0,a.jsxs)("div",{className:"mb-6 mt-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("h3",{className:"text-lg font-bold",children:"M\xe9todo de elaboraci\xf3n (Pasos)"}),(0,a.jsxs)("button",{type:"button",onClick:()=>{v([...f,{key:crypto.randomUUID(),order:f.length+1,description:"",action:"",subAction:"",ingredientId:""}])},className:"flex items-center gap-1 rounded bg-blue-100 px-3 py-1 text-sm text-blue-600 hover:bg-blue-200",children:[(0,a.jsx)(d.A,{className:"w-4"})," A\xf1adir Paso"]})]}),0===f.length&&(0,a.jsx)("p",{className:"text-gray-500 italic text-sm",children:"No hay pasos definidos."}),(0,a.jsx)("div",{className:"space-y-4",children:f.map((e,r)=>(0,a.jsxs)("div",{className:"flex flex-col gap-2 p-3 bg-white rounded border border-gray-200 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex gap-2 items-start",children:[(0,a.jsx)("span",{className:"flex-none flex items-center justify-center w-6 h-6 rounded-full bg-gray-100 font-bold text-xs text-gray-600 mt-1",children:e.order}),(0,a.jsx)("textarea",{className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm",rows:2,placeholder:"",value:e.description,onChange:e=>k(r,"description",e.target.value)}),(0,a.jsx)("button",{type:"button",onClick:()=>{let e;(e=[...f]).splice(r,1),v(e.map((e,r)=>({...e,order:r+1})))},className:"text-red-500 hover:text-red-700 p-1",children:(0,a.jsx)(o.A,{className:"w-5"})})]}),(0,a.jsxs)("div",{className:"ml-8 flex flex-wrap gap-2 items-center",children:[(0,a.jsxs)("select",{className:"text-xs rounded border-gray-200 py-1 pl-2 pr-6",value:e.action||"",onChange:e=>k(r,"action",e.target.value),children:[(0,a.jsx)("option",{value:"",children:"-- Acci\xf3n --"}),Object.keys(N).map(e=>(0,a.jsx)("option",{value:e,children:e},e))]}),e.action&&N[e.action]&&(0,a.jsxs)("select",{className:"text-xs rounded border-gray-200 py-1 pl-2 pr-6",value:e.subAction||"",onChange:e=>k(r,"subAction",e.target.value),children:[(0,a.jsx)("option",{value:"",children:"-- T\xe9cnica --"}),N[e.action].map(e=>(0,a.jsx)("option",{value:e,children:e},e))]}),(0,a.jsxs)("select",{className:"text-xs rounded border-gray-200 py-1 pl-2 pr-6 max-w-[150px]",value:e.ingredientId||"",onChange:e=>k(r,"ingredientId",e.target.value),children:[(0,a.jsx)("option",{value:"",children:"-- Ingrediente Relacionado --"}),I.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]},e.key))})]}),(0,a.jsx)("div",{"aria-live":"polite","aria-atomic":"true",children:p.message&&(0,a.jsx)("p",{className:"mt-2 text-sm text-red-500",children:p.message})})]}),(0,a.jsxs)("div",{className:"mt-6 flex justify-end gap-4",children:[(0,a.jsx)(n(),{href:"/dashboard/recipes",className:"flex h-10 items-center rounded-lg bg-gray-100 px-4 text-sm font-medium text-gray-600 transition-colors hover:bg-gray-200",children:"Cancelar"}),(0,a.jsx)("button",{type:"submit",className:"flex h-10 items-center rounded-lg bg-blue-600 px-4 text-sm font-medium text-white transition-colors hover:bg-blue-500",children:"Actualizar Receta"})]})]})}},5974:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a={callServer:function(){return l.callServer},createServerReference:function(){return n.createServerReference},findSourceMapURL:function(){return s.findSourceMapURL}};for(var i in a)Object.defineProperty(r,i,{enumerable:!0,get:a[i]});let l=t(4273),s=t(6409),n=t(7102)}},e=>{e.O(0,[5587,587,1968,7358],()=>e(e.s=993)),_N_E=e.O()}]);